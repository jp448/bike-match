FROM ruby:2.6.6-alpine



ARG SECRET_KEY_BASE=${SECRET_KEY_BASE}

ARG RAILS_SERVE_STATIC_FILES=${RAILS_SERVE_STATIC_FILES}

ARG MAPBOX_API_KEY=${MAPBOX_API_KEY}

ARG CLOUDINARY_URL=${CLOUDINARY_URL}

ARG RAILS_LOG_TO_STDOUT=${RAILS_LOG_TO_STDOUT}

ARG RAILS_ENV=${RAILS_ENV}

ARG RAILS_DB_URL=${RAILS_DB_URL}

ARG RAILS_DB_USER=${RAILS_DB_USER}

ARG RAILS_DB_PASSWORD=${RAILS_DB_PASSWORD}



# Ubuntu



#RUN apt-get update -qq && apt-get install -y nodejs yarn postgresql-client postgresql-dev



# Alpine



RUN apk update && apk add nodejs yarn postgresql-client postgresql-dev tzdata build-base



WORKDIR /usr/src/app



RUN gem install bundler:2.1.4



ENV SECRET_KEY_BASE $SECRET_KEY_BASE

ENV RAILS_SERVE_STATIC_FILES $RAILS_SERVE_STATIC_FILES

ENV MAPBOX_API_KEY $MAPBOX_API_KEY

ENV CLOUDINARY_URL $CLOUDINARY_URL

ENV RAILS_LOG_TO_STDOUT $RAILS_LOG_TO_STDOUT

ENV RAILS_ENV $RAILS_ENV

ENV RAILS_DB_URL $RAILS_DB_URL

ENV RAILS_DB_USER $RAILS_DB_USER

ENV RAILS_DB_PASSWORD $RAILS_DB_PASSWORD





# Set the gemfile and install



COPY Gemfile* ./



RUN bundle install



# Copy the main application.



COPY . ./



